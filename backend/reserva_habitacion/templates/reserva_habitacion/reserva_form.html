<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Reservar Habitación - Hotel Indigo</title>\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\" rel=\"stylesheet\">\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            padding: 20px;\n        }\n\n        .container {\n            max-width: 800px;\n            margin: 0 auto;\n            background: white;\n            border-radius: 20px;\n            box-shadow: 0 20px 40px rgba(0,0,0,0.1);\n            overflow: hidden;\n        }\n\n        .header {\n            background: linear-gradient(135deg, #d0a75f 0%, #b8924f 100%);\n            color: white;\n            padding: 30px;\n            text-align: center;\n        }\n\n        .header h1 {\n            font-size: 2.5rem;\n            margin-bottom: 10px;\n        }\n\n        .header p {\n            font-size: 1.1rem;\n            opacity: 0.9;\n        }\n\n        .progress-bar {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            padding: 30px;\n            background: #f8f9fa;\n        }\n\n        .step {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            margin: 0 20px;\n            opacity: 0.5;\n            transition: all 0.3s ease;\n        }\n\n        .step.active {\n            opacity: 1;\n        }\n\n        .step-number {\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            background: #ddd;\n            color: #666;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: bold;\n            font-size: 1.2rem;\n            margin-bottom: 10px;\n            transition: all 0.3s ease;\n        }\n\n        .step.active .step-number {\n            background: #d0a75f;\n            color: white;\n            transform: scale(1.1);\n        }\n\n        .step-title {\n            font-weight: 600;\n            color: #666;\n        }\n\n        .step.active .step-title {\n            color: #2c3e50;\n        }\n\n        .form-container {\n            padding: 40px;\n        }\n\n        .form-section {\n            margin-bottom: 30px;\n        }\n\n        .form-section h3 {\n            color: #2c3e50;\n            margin-bottom: 20px;\n            font-size: 1.4rem;\n            border-bottom: 2px solid #d0a75f;\n            padding-bottom: 10px;\n        }\n\n        .form-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n        }\n\n        .form-group {\n            display: flex;\n            flex-direction: column;\n        }\n\n        .form-group.full-width {\n            grid-column: 1 / -1;\n        }\n\n        .form-group label {\n            font-weight: 600;\n            margin-bottom: 8px;\n            color: #2c3e50;\n            font-size: 0.9rem;\n        }\n\n        .form-group input,\n        .form-group select,\n        .form-group textarea {\n            padding: 12px 15px;\n            border: 2px solid #ddd;\n            border-radius: 10px;\n            font-size: 1rem;\n            transition: all 0.3s ease;\n            font-family: inherit;\n        }\n\n        .form-group input:focus,\n        .form-group select:focus,\n        .form-group textarea:focus {\n            outline: none;\n            border-color: #d0a75f;\n            box-shadow: 0 0 0 3px rgba(208, 167, 95, 0.1);\n        }\n\n        .btn {\n            padding: 15px 30px;\n            border: none;\n            border-radius: 10px;\n            font-size: 1.1rem;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n\n        .btn-primary {\n            background: linear-gradient(135deg, #d0a75f 0%, #b8924f 100%);\n            color: white;\n            width: 100%;\n        }\n\n        .btn-primary:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 20px rgba(208, 167, 95, 0.3);\n        }\n\n        .btn-secondary {\n            background: #6c757d;\n            color: white;\n            margin-right: 10px;\n        }\n\n        .btn-secondary:hover {\n            background: #5a6268;\n        }\n\n        .summary-card {\n            background: #f8f9fa;\n            border-radius: 15px;\n            padding: 25px;\n            margin-top: 20px;\n            border-left: 5px solid #d0a75f;\n        }\n\n        .summary-item {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 10px;\n            padding: 8px 0;\n            border-bottom: 1px solid #eee;\n        }\n\n        .summary-item:last-child {\n            border-bottom: none;\n            font-weight: bold;\n            font-size: 1.2rem;\n            color: #d0a75f;\n        }\n\n        .otp-container {\n            text-align: center;\n            padding: 40px 20px;\n        }\n\n        .otp-input {\n            text-align: center;\n            font-size: 2rem;\n            font-weight: bold;\n            letter-spacing: 10px;\n            max-width: 300px;\n            margin: 20px auto;\n        }\n\n        .success-container {\n            text-align: center;\n            padding: 60px 20px;\n        }\n\n        .success-icon {\n            width: 100px;\n            height: 100px;\n            background: #27ae60;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin: 0 auto 30px;\n            font-size: 3rem;\n            color: white;\n        }\n\n        .error {\n            color: #e74c3c;\n            font-size: 0.9rem;\n            margin-top: 5px;\n        }\n\n        .hidden {\n            display: none;\n        }\n\n        @media (max-width: 768px) {\n            .form-grid {\n                grid-template-columns: 1fr;\n            }\n            \n            .container {\n                margin: 10px;\n                border-radius: 15px;\n            }\n            \n            .header h1 {\n                font-size: 2rem;\n            }\n            \n            .step {\n                margin: 0 10px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1><i class=\"fas fa-hotel\"></i> Hotel Indigo</h1>\n            <p>Sistema de Reservas Online</p>\n        </div>\n\n        <div class=\"progress-bar\">\n            <div class=\"step active\" id=\"step-1\">\n                <div class=\"step-number\">1</div>\n                <div class=\"step-title\">Información</div>\n            </div>\n            <div class=\"step\" id=\"step-2\">\n                <div class=\"step-number\">2</div>\n                <div class=\"step-title\">Verificación</div>\n            </div>\n            <div class=\"step\" id=\"step-3\">\n                <div class=\"step-number\"><i class=\"fas fa-check\"></i></div>\n                <div class=\"step-title\">Confirmado</div>\n            </div>\n        </div>\n\n        <div class=\"form-container\">\n            <!-- Paso 1: Formulario de datos -->\n            <div id=\"form-step-1\">\n                <form id=\"reservationForm\">\n                    <div class=\"form-section\">\n                        <h3><i class=\"fas fa-user\"></i> Datos Personales</h3>\n                        <div class=\"form-grid\">\n                            <div class=\"form-group\">\n                                <label for=\"nombre\">Nombre *</label>\n                                <input type=\"text\" id=\"nombre\" name=\"nombre\" required>\n                                <div class=\"error\" id=\"error-nombre\"></div>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"apellido\">Apellido *</label>\n                                <input type=\"text\" id=\"apellido\" name=\"apellido\" required>\n                                <div class=\"error\" id=\"error-apellido\"></div>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"cedula\">Cédula *</label>\n                                <input type=\"text\" id=\"cedula\" name=\"cedula\" placeholder=\"V-12345678\" required>\n                                <div class=\"error\" id=\"error-cedula\"></div>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"telefono\">Teléfono *</label>\n                                <input type=\"tel\" id=\"telefono\" name=\"telefono\" placeholder=\"0412-1234567\" required>\n                                <div class=\"error\" id=\"error-telefono\"></div>\n                            </div>\n                            <div class=\"form-group full-width\">\n                                <label for=\"email\">Email *</label>\n                                <input type=\"email\" id=\"email\" name=\"email\" placeholder=\"cliente@email.com\" required>\n                                <div class=\"error\" id=\"error-email\"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-section\">\n                        <h3><i class=\"fas fa-calendar\"></i> Detalles de Estancia</h3>\n                        <div class=\"form-grid\">\n                            <div class=\"form-group\">\n                                <label for=\"fecha_checkin\">Check-in *</label>\n                                <input type=\"date\" id=\"fecha_checkin\" name=\"fecha_checkin\" required>\n                                <div class=\"error\" id=\"error-fecha_checkin\"></div>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"fecha_checkout\">Check-out *</label>\n                                <input type=\"date\" id=\"fecha_checkout\" name=\"fecha_checkout\" required>\n                                <div class=\"error\" id=\"error-fecha_checkout\"></div>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"huespedes\">Huéspedes</label>\n                                <select id=\"huespedes\" name=\"huespedes\">\n                                    <option value=\"1\">1 Huésped</option>\n                                    <option value=\"2\">2 Huéspedes</option>\n                                    <option value=\"3\">3 Huéspedes</option>\n                                    <option value=\"4\">4 Huéspedes</option>\n                                </select>\n                            </div>\n                            <div class=\"form-group full-width\">\n                                <label for=\"notas\">Notas adicionales</label>\n                                <textarea id=\"notas\" name=\"notas\" rows=\"3\" placeholder=\"Solicitudes especiales...\"></textarea>\n                            </div>\n                        </div>\n                    </div>\n\n                    {% if habitacion %}\n                    <div class=\"summary-card\">\n                        <h3><i class=\"fas fa-bed\"></i> Resumen de Reserva</h3>\n                        <div class=\"summary-item\">\n                            <span>Habitación:</span>\n                            <span>{{ habitacion.categoria|title }} - {{ habitacion.tamaño_cama|title }}</span>\n                        </div>\n                        <div class=\"summary-item\">\n                            <span>Precio por noche:</span>\n                            <span>${{ habitacion.precio_base }}</span>\n                        </div>\n                        <div class=\"summary-item\" id=\"total-summary\">\n                            <span>Total Estimado:</span>\n                            <span id=\"total-amount\">$0.00</span>\n                        </div>\n                    </div>\n                    {% endif %}\n\n                    <button type=\"submit\" class=\"btn btn-primary\">\n                        <i class=\"fas fa-paper-plane\"></i> Crear Reserva\n                    </button>\n                </form>\n            </div>\n\n            <!-- Paso 2: Verificación OTP -->\n            <div id=\"form-step-2\" class=\"hidden\">\n                <div class=\"otp-container\">\n                    <h2><i class=\"fas fa-shield-alt\"></i> Verificación de Email</h2>\n                    <p>Hemos enviado un código de 6 dígitos a tu email</p>\n                    <p><strong id=\"email-destino\"></strong></p>\n                    \n                    <form id=\"otpForm\">\n                        <div class=\"form-group\">\n                            <label for=\"codigo_otp\">Código de Verificación</label>\n                            <input type=\"text\" id=\"codigo_otp\" name=\"codigo_otp\" class=\"otp-input\" maxlength=\"6\" placeholder=\"000000\" required>\n                            <div class=\"error\" id=\"error-otp\"></div>\n                        </div>\n                        \n                        <button type=\"submit\" class=\"btn btn-primary\">\n                            <i class=\"fas fa-check\"></i> Confirmar Reserva\n                        </button>\n                        \n                        <div style=\"margin-top: 20px;\">\n                            <button type=\"button\" id=\"resend-otp\" class=\"btn btn-secondary\">\n                                <i class=\"fas fa-sync\"></i> Reenviar Código\n                            </button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n\n            <!-- Paso 3: Confirmación -->\n            <div id=\"form-step-3\" class=\"hidden\">\n                <div class=\"success-container\">\n                    <div class=\"success-icon\">\n                        <i class=\"fas fa-check\"></i>\n                    </div>\n                    <h2>¡Reserva Confirmada!</h2>\n                    <p>Tu reserva ha sido confirmada exitosamente.</p>\n                    <p>Hemos enviado los detalles completos a tu email.</p>\n                    \n                    <div style=\"margin-top: 30px;\">\n                        <button onclick=\"window.location.href='/'\" class=\"btn btn-primary\">\n                            <i class=\"fas fa-home\"></i> Volver al Inicio\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        let currentStep = 1;\n        let reservaId = null;\n        const habitacionId = {{ habitacion.id|default:\"null\" }};\n        const precioBase = {{ habitacion.precio_base|default:\"0\" }};\n\n        // Configurar fecha mínima\n        document.getElementById('fecha_checkin').min = new Date().toISOString().split('T')[0];\n\n        // Calcular total cuando cambien las fechas\n        document.getElementById('fecha_checkin').addEventListener('change', calcularTotal);\n        document.getElementById('fecha_checkout').addEventListener('change', calcularTotal);\n\n        function calcularTotal() {\n            const checkin = new Date(document.getElementById('fecha_checkin').value);\n            const checkout = new Date(document.getElementById('fecha_checkout').value);\n            \n            if (checkin && checkout && checkout > checkin) {\n                const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));\n                const total = nights * precioBase;\n                document.getElementById('total-amount').textContent = `$${total.toFixed(2)}`;\n                \n                // Actualizar fecha mínima de checkout\n                const minCheckout = new Date(checkin);\n                minCheckout.setDate(minCheckout.getDate() + 1);\n                document.getElementById('fecha_checkout').min = minCheckout.toISOString().split('T')[0];\n            }\n        }\n\n        function showStep(step) {\n            // Ocultar todos los pasos\n            for (let i = 1; i <= 3; i++) {\n                document.getElementById(`form-step-${i}`).classList.add('hidden');\n                document.getElementById(`step-${i}`).classList.remove('active');\n            }\n            \n            // Mostrar paso actual\n            document.getElementById(`form-step-${step}`).classList.remove('hidden');\n            document.getElementById(`step-${step}`).classList.add('active');\n            \n            currentStep = step;\n        }\n\n        function clearErrors() {\n            document.querySelectorAll('.error').forEach(el => el.textContent = '');\n        }\n\n        function showError(field, message) {\n            const errorEl = document.getElementById(`error-${field}`);\n            if (errorEl) {\n                errorEl.textContent = message;\n            }\n        }\n\n        // Manejar envío del formulario de reserva\n        document.getElementById('reservationForm').addEventListener('submit', async (e) => {\n            e.preventDefault();\n            clearErrors();\n            \n            const formData = new FormData(e.target);\n            const data = {\n                habitacion_id: habitacionId,\n                nombre: formData.get('nombre'),\n                apellido: formData.get('apellido'),\n                cedula: formData.get('cedula'),\n                telefono: formData.get('telefono'),\n                email: formData.get('email'),\n                fecha_checkin: formData.get('fecha_checkin'),\n                fecha_checkout: formData.get('fecha_checkout'),\n                huespedes: formData.get('huespedes'),\n                notas: formData.get('notas')\n            };\n            \n            try {\n                const response = await fetch('/reservas/api/crear-reserva/', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': getCookie('csrftoken')\n                    },\n                    body: JSON.stringify(data)\n                });\n                \n                const result = await response.json();\n                \n                if (result.success) {\n                    reservaId = result.reserva_id;\n                    document.getElementById('email-destino').textContent = data.email;\n                    showStep(2);\n                } else {\n                    alert('Error: ' + result.error);\n                }\n            } catch (error) {\n                alert('Error de conexión: ' + error.message);\n            }\n        });\n\n        // Manejar verificación OTP\n        document.getElementById('otpForm').addEventListener('submit', async (e) => {\n            e.preventDefault();\n            clearErrors();\n            \n            const codigo = document.getElementById('codigo_otp').value;\n            \n            try {\n                const response = await fetch(`/reservas/api/verificar-otp/${reservaId}/`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': getCookie('csrftoken')\n                    },\n                    body: JSON.stringify({ codigo_otp: codigo })\n                });\n                \n                const result = await response.json();\n                \n                if (result.success) {\n                    showStep(3);\n                } else {\n                    showError('otp', result.error);\n                }\n            } catch (error) {\n                showError('otp', 'Error de conexión');\n            }\n        });\n\n        // Manejar reenvío de OTP\n        document.getElementById('resend-otp').addEventListener('click', async () => {\n            try {\n                const response = await fetch(`/reservas/api/reenviar-otp/${reservaId}/`, {\n                    method: 'POST',\n                    headers: {\n                        'X-CSRFToken': getCookie('csrftoken')\n                    }\n                });\n                \n                const result = await response.json();\n                \n                if (result.success) {\n                    alert('Código reenviado exitosamente');\n                } else {\n                    alert('Error: ' + result.error);\n                }\n            } catch (error) {\n                alert('Error de conexión');\n            }\n        });\n\n        // Función para obtener cookie CSRF\n        function getCookie(name) {\n            let cookieValue = null;\n            if (document.cookie && document.cookie !== '') {\n                const cookies = document.cookie.split(';');\n                for (let i = 0; i < cookies.length; i++) {\n                    const cookie = cookies[i].trim();\n                    if (cookie.substring(0, name.length + 1) === (name + '=')) {\n                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n                        break;\n                    }\n                }\n            }\n            return cookieValue;\n        }\n\n        // Calcular total inicial\n        calcularTotal();\n    </script>\n</body>\n</html>"